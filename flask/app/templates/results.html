{% extends "base.html" %}

{% block content %}

<div class="container-fluid" id="detail-header">
    <img href="" style="max-height:50px; display:inline-block; margin-bottom:20px;" src="{{ url_for('static', filename='img/reddit.png')}}">
    <h4 style="display:inline-block; font-size:40px;"> <a href="index.html" style="color:white;"> Reddit Political Sentiment Explorer </a></h4>
    <form class="input-group" action="demo.html">
        <input class="form-control" name="q" type="text" placeholder="{{url_string}}">
        <span class="input-group-btn">
                  <button class="btn btn-secondary" href="demo.html" style="height:38px!important;" type="submit">
                  Explore
                  </button>
                </span>
    </form>
</div>

{% if results|length == 0 %}
    <br><br><br><br>
    <h2 id="results-announcement">
        This link has not been submitted to Reddit, or has no comments on its discussions.
    </h2>
    <h4 id="warning-announcement">
        Think this message was reached in error? <a href="mailto:klingj3@rpi.edu"> Message us! </a>
    </h4>

{% else %}


<div class="container-fluid">
    <h2 id="results-announcement">
        This link is being discussed in <b>{{results|length}}</b> communities
    </h2>

{% for result in results %}
    {% if result.comment_count > 0 %}
    <div class="card-deck">
        <div class="card results-card">
            <h4><a href="https://reddit.com/r/{{result.subreddit}}" class="subreddit"> {{ result.subreddit }} </a> |
                <a href="{{result.url}}"  class="comments"> {{result.score}} points | {{result.comment_count}}
                    {% if result.comment_count == 1 %}
                        comment
                    {% else %}
                        comments
                    {% endif %}
                </a> </h4>
            <h4 class="title"> {{ result.title }}</h4>
            <div class="skillbar clearfix " data-percent="{{ result.l_percentage }}%">
                <div class="skillbar-title" style="background: #2980b9;"><span>Pro-Democrat </div>
                <div class="skillbar-bar" style="background: #3498db;"></div>
                <div class="skill-bar-percent">{{ result.l_percentage }}%</div>
            </div> <!-- End Skill Bar -->
            <div class="skillbar clearfix" data-percent="{{ result.r_percentage }}%">
                <div class="skillbar-title" style="background: #7d0004;"><span>Pro-Republican </div>
                <div class="skillbar-bar" style="background: #cd0007;"></div>
                <div class="skill-bar-percent">{{ result.r_percentage }}%</div>
            </div> <!-- End Skill Bar -->

                <p>Top commments:</p>
                {% for comment in result.top_comments %}
                    <div class="comment-block">
                        {% for word in comment.words %}
                            {% if word in comment.r_words %}
                                <span class="red"> {{word}} </span>
                            {% elif word in comment.l_words %}
                                <span class="blue"> {{word}}</span>
                            {% else %}
                                {{word}}
                            {% endif %}
                        {% endfor %}
                    <br>
                    {% if comment.score != 1 %}:
                        <a class="comments" href="comment.url"> {{comment.score}} points</a>
                    {% else %}
                        <a class="comments" href="comment.url"> Score Hidden </a>
                    {% endif %}
                    </div>
                {% endfor %}
        </div>
    </div>
    {% endif %}
{% endfor %}

</div>
    {% endif %}

    <script>
        jQuery(document).ready(function(){
            jQuery('.skillbar').each(function(){
                jQuery(this).find('.skillbar-bar').animate({
                    width:jQuery(this).attr('data-percent')
                },6000);
            });
        });
    </script>



{% endblock %}